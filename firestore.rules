// üîê Regras de Seguran√ßa do Firestore
// Copie e cole estas regras no Firebase Console > Firestore Database > Regras

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ==========================================
    // ATHLETES COLLECTION
    // ==========================================
    match /athletes/{athleteId} {
      // Permite leitura para todos
      allow read: if true;
      
      // Permite cria√ß√£o e atualiza√ß√£o para todos (ajuste conforme necessidade)
      allow create, update: if true;
      
      // Permite dele√ß√£o para todos (ajuste conforme necessidade)
      allow delete: if true;
      
      // TODO: Adicionar autentica√ß√£o
      // allow write: if request.auth != null && request.auth.uid == 'admin-uid';
    }
    
    // ==========================================
    // SEASONS COLLECTION
    // ==========================================
    match /seasons/{seasonId} {
      // Permite leitura para todos
      allow read: if true;
      
      // Permite cria√ß√£o e atualiza√ß√£o para todos (ajuste conforme necessidade)
      allow create, update: if true;
      
      // Permite dele√ß√£o para todos (ajuste conforme necessidade)
      allow delete: if true;
      
      // ==========================================
      // CHECKINS SUBCOLLECTION
      // ==========================================
      match /checkins/{checkinId} {
        // Permite leitura para todos
        allow read: if true;
        
        // Permite escrita para todos (ajuste conforme necessidade)
        allow write: if true;
        
        // Valida√ß√£o de estrutura de dados
        allow create, update: if request.resource.data.keys().hasAll(['date', 'athletes', 'updatedAt'])
                              && request.resource.data.date is string
                              && request.resource.data.athletes is map
                              && request.resource.data.updatedAt is timestamp;
      }
      
      // ==========================================
      // PAYMENTS SUBCOLLECTION
      // ==========================================
      match /payments/{paymentId} {
        // Permite leitura para todos
        allow read: if true;
        
        // Permite escrita para todos (ajuste conforme necessidade)
        allow write: if true;
        
        // Valida√ß√£o de estrutura de dados
        allow create: if request.resource.data.keys().hasAll(['athleteId', 'date', 'value', 'createdAt'])
                      && request.resource.data.athleteId is string
                      && request.resource.data.date is timestamp
                      && request.resource.data.value is number
                      && request.resource.data.value > 0
                      && request.resource.data.createdAt is timestamp;
      }
    }
  }
}

// ==========================================
// VERS√ÉO COM AUTENTICA√á√ÉO (FUTURA IMPLEMENTA√á√ÉO)
// ==========================================
// Descomente e ajuste quando implementar autentica√ß√£o

/*
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Fun√ß√£o helper para verificar se √© admin
    function isAdmin() {
      return request.auth != null && 
             exists(/databases/$(database)/documents/admins/$(request.auth.uid));
    }
    
    // Fun√ß√£o helper para verificar se √© o pr√≥prio usu√°rio
    function isOwner(userId) {
      return request.auth != null && request.auth.uid == userId;
    }
    
    // ATHLETES - Admin pode tudo, usu√°rios podem ler
    match /athletes/{athleteId} {
      allow read: if request.auth != null;
      allow write: if isAdmin();
    }
    
    // SEASONS - Admin pode tudo, usu√°rios podem ler
    match /seasons/{seasonId} {
      allow read: if request.auth != null;
      allow write: if isAdmin();
      
      // CHECKINS - Admin pode tudo, usu√°rios podem ler
      match /checkins/{checkinId} {
        allow read: if request.auth != null;
        allow write: if isAdmin();
      }
      
      // PAYMENTS - Admin pode tudo, usu√°rios podem ver seus pr√≥prios
      match /payments/{paymentId} {
        allow read: if request.auth != null && 
                    (isAdmin() || resource.data.athleteId == request.auth.uid);
        allow write: if isAdmin();
      }
    }
    
    // ADMINS - Apenas admins podem ler e escrever
    match /admins/{adminId} {
      allow read, write: if isAdmin();
    }
  }
}
*/
